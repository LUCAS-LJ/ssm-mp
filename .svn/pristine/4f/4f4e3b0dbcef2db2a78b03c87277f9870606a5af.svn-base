var bufferview=$.extend({},$.fn.datagrid.defaults.view,{render:function(k,e,a){var d=$.data(k,"datagrid");var b=d.options;var o=this.rows||[];if(!o.length){return}var h=$(k).datagrid("getColumnFields",a);if(a){if(!(b.rownumbers||(b.frozenColumns&&b.frozenColumns.length))){return}}var j=parseInt(b.finder.getTr(k,"","last",(a?1:2)).attr("datagrid-row-index"))+1||0;var m=['<table class="datagrid-btable" cellspacing="0" cellpadding="0" border="0"><tbody>'];for(var g=0;g<o.length;g++){var l=(j%2&&b.striped)?'class="datagrid-row datagrid-row-alt"':'class="datagrid-row"';var n=b.rowStyler?b.rowStyler.call(k,j,o[g]):"";var c=n?'style="'+n+'"':"";var f=d.rowIdPrefix+"-"+(a?1:2)+"-"+j;m.push('<tr id="'+f+'" datagrid-row-index="'+j+'" '+l+" "+c+">");m.push(this.renderRow.call(this,k,h,a,j,o[g]));m.push("</tr>");j++}m.push("</tbody></table>");$(e).append(m.join(""))},onBeforeRender:function(f){var d=$.data(f,"datagrid");var c=d.options;var b=d.dc;var a=this;this.renderedCount=0;this.rows=[];d.onLoadSuccess=c.onLoadSuccess;c.onLoadSuccess=function(){};b.body1.add(b.body2).empty();b.body2.unbind(".datagrid").bind("scroll.datagrid",function(g){if(d.onLoadSuccess){c.onLoadSuccess=d.onLoadSuccess;d.onLoadSuccess=undefined}if($(this).scrollTop()>=e()-$(this).height()){if(this.scrollTimer){clearTimeout(this.scrollTimer)}this.scrollTimer=setTimeout(function(){a.populate.call(a,f);while(e()<b.body2.height()&&a.renderedCount<d.data.total){a.populate.call(a,f)}},50)}});function e(){var g=0;b.body2.children("table.datagrid-btable").each(function(){g+=$(this).outerHeight()});return g}},populate:function(e){var d=$.data(e,"datagrid");var c=d.options;var b=d.dc;if(this.renderedCount>=d.data.total){return}this.rows=d.data.rows.slice(this.renderedCount,this.renderedCount+c.pageSize);if(this.rows.length){this.renderedCount+=this.rows.length;c.view.render.call(c.view,e,b.body2,false);c.view.render.call(c.view,e,b.body1,true);c.onLoadSuccess.call(e,{total:d.data.total,rows:this.rows})}else{var f=$.extend({},c.queryParams,{page:Math.floor(this.renderedCount/c.pageSize)+1,rows:c.pageSize});if(c.sortName){$.extend(f,{sort:c.sortName,order:c.sortOrder})}if(c.onBeforeLoad.call(e,f)==false){return}$(e).datagrid("loading");var a=c.loader.call(e,f,function(g){$(e).datagrid("loaded");var g=c.loadFilter.call(e,g);d.data.rows=d.data.rows.concat(g.rows);c.view.rows=g.rows;c.view.renderedCount+=g.rows.length;c.view.render.call(c.view,e,b.body2,false);c.view.render.call(c.view,e,b.body1,true);c.onLoadSuccess.call(e,g)},function(){$(e).datagrid("loaded");c.onLoadError.apply(e,arguments)});if(a==false){$(e).datagrid("loaded")}}}});