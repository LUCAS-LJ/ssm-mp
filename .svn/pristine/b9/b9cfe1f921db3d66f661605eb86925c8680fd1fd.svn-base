(function(a){function e(l){a(l).addClass("portal");var j=a('<table border="0" cellspacing="0" cellpadding="0"><tr></tr></table>').appendTo(l);var k=j.find("tr");var g=[];var f=0;a(l).children("div:first").addClass("portal-column-left");a(l).children("div:last").addClass("portal-column-right");a(l).find(">div").each(function(){var i=a(this);f+=i.outerWidth();g.push(i.outerWidth());var m=a('<td class="portal-column-td"></td>').appendTo(k);i.addClass("portal-column").appendTo(m);i.find(">div").each(function(){var n=a(this).addClass("portal-p").panel({doSize:false,cls:"portal-panel"});c(l,n)})});for(var h=0;h<g.length;h++){g[h]/=f}a(l).bind("_resize",function(){var i=a.data(l,"portal").options;if(i.fit==true){d(l)}return false});return g}function b(){if(!a("#easyui-portal-style").length){a("head").append('<style id="easyui-portal-style">.portal{padding:0;margin:0;overflow:auto;border:1px solid #99bbe8;}.portal-noborder{border:0;}.portal .portal-panel{margin-bottom:10px;}.portal-column-td{vertical-align:top;}.portal-column{padding:10px 0 10px 10px;overflow:hidden;}.portal-column-left{padding-left:10px;}.portal-column-right{padding-right:10px;}.portal-proxy{opacity:0.6;filter:alpha(opacity=60);}.portal-spacer{border:3px dashed #eee;margin-bottom:10px;}</style>')}}function d(m){var q=a(m);var f=a.data(m,"portal").options;if(f.fit){var h=q.parent();f.width=h.width();f.height=h.height()}if(!isNaN(f.width)){q._outerWidth(f.width)}else{q.width("auto")}if(!isNaN(f.height)){q._outerHeight(f.height)}else{q.height("auto")}var o=q.find(">table").outerHeight()>q.height();var j=q.width();var g=a.data(m,"portal").columnWidths;var k=0;for(var l=0;l<g.length;l++){var h=q.find("div.portal-column:eq("+l+")");var n=Math.floor(j*g[l]);if(l==g.length-1){n=j-k-(o==true?18:0)}h._outerWidth(n);k+=h.outerWidth();h.find("div.portal-p").panel("resize",{width:h.width()})}f.onResize.call(m,f.width,f.height)}function c(j,g){var i;g.panel("panel").draggable({handle:">div.panel-header>div.panel-title",proxy:function(l){var m=a('<div class="portal-proxy">proxy</div>').insertAfter(l);m.width(a(l).width());m.height(a(l).height());m.html(a(l).html());m.find("div.portal-p").removeClass("portal-p");return m},onBeforeDrag:function(l){l.data.startTop=a(this).position().top+a(j).scrollTop()},onStartDrag:function(l){a(this).hide();i=a('<div class="portal-spacer"></div>').insertAfter(this);k(a(this).outerWidth(),a(this).outerHeight())},onDrag:function(m){var l=f(m,this);if(l){if(l.pos=="up"){i.insertBefore(l.target)}else{i.insertAfter(l.target)}k(a(l.target).outerWidth())}else{var n=h(m);if(n){if(n.find("div.portal-spacer").length==0){i.appendTo(n);d(j);k(n.width())}}}},onStopDrag:function(m){a(this).css("position","static");a(this).show();i.hide();a(this).insertAfter(i);i.remove();d(j);g.panel("move");var l=a.data(j,"portal").options;l.onStateChange.call(j)}});function f(n,m){var l=null;a(j).find("div.portal-p").each(function(){var o=a(this).panel("panel");if(o[0]!=m){var p=o.offset();if(n.pageX>p.left&&n.pageX<p.left+o.outerWidth()&&n.pageY>p.top&&n.pageY<p.top+o.outerHeight()){if(n.pageY>p.top+o.outerHeight()/2){l={target:o,pos:"down"}}else{l={target:o,pos:"up"}}}}});return l}function h(m){var l=null;a(j).find("div.portal-column").each(function(){var n=a(this);var o=n.offset();if(m.pageX>o.left&&m.pageX<o.left+n.outerWidth()){l=n}});return l}function k(m,l){i._outerWidth(m);if(l){i._outerHeight(l)}}}a.fn.portal=function(f,g){if(typeof f=="string"){return a.fn.portal.methods[f](this,g)}f=f||{};return this.each(function(){var h=a.data(this,"portal");if(h){a.extend(h.options,f)}else{h=a.data(this,"portal",{options:a.extend({},a.fn.portal.defaults,a.fn.portal.parseOptions(this),f),columnWidths:e(this)})}if(h.options.border){a(this).removeClass("portal-noborder")}else{a(this).addClass("portal-noborder")}b();d(this)})};a.fn.portal.methods={options:function(f){return a.data(f[0],"portal").options},resize:function(g,f){return g.each(function(){if(f){var h=a.data(this,"portal").options;if(f.width){h.width=f.width}if(f.height){h.height=f.height}}d(this)})},getPanels:function(i,g){var h=i;if(g>=0){h=i.find("div.portal-column:eq("+g+")")}var f=[];h.find("div.portal-p").each(function(){f.push(a(this))});return f},add:function(g,f){return g.each(function(){var i=a(this).find("div.portal-column:eq("+f.columnIndex+")");var h=f.panel.addClass("portal-p");h.panel("panel").addClass("portal-panel").appendTo(i);c(this,h);h.panel("resize",{width:i.width()})})},remove:function(g,f){return g.each(function(){var h=a(this).portal("getPanels");for(var j=0;j<h.length;j++){var k=h[j];if(k[0]==a(f)[0]){k.panel("destroy")}}})},disableDragging:function(g,f){f.panel("panel").draggable("disable");return g},enableDragging:function(g,f){f.panel("panel").draggable("enable");return g}};a.fn.portal.parseOptions=function(g){var f=a(g);return{width:(parseInt(g.style.width)||undefined),height:(parseInt(g.style.height)||undefined),border:(f.attr("border")?f.attr("border")=="true":undefined),fit:(f.attr("fit")?f.attr("fit")=="true":undefined)}};a.fn.portal.defaults={width:"auto",height:"auto",border:true,fit:false,onResize:function(g,f){},onStateChange:function(){}}})(jQuery);