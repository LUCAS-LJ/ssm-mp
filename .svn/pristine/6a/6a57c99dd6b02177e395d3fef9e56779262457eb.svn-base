var groupview=$.extend({},$.fn.datagrid.defaults.view,{render:function(n,e,a){var d=$.data(n,"datagrid");var b=d.options;var s=d.data.rows;var l=$(n).datagrid("getColumnFields",a);var q=[];var m=0;var f=this.groups;for(var k=0;k<f.length;k++){var o=f[k];q.push('<div class="datagrid-group" group-index='+k+' style="height:25px;overflow:hidden;border-bottom:1px solid #ccc;">');q.push('<table cellspacing="0" cellpadding="0" border="0" style="height:100%"><tbody>');q.push("<tr>");q.push('<td style="border:0;">');if(!a){q.push('<span style="color:#666;font-weight:bold;">');q.push(b.groupFormatter.call(n,o.fvalue,o.rows));q.push("</span>")}q.push("</td>");q.push("</tr>");q.push("</tbody></table>");q.push("</div>");q.push('<table class="datagrid-btable" cellspacing="0" cellpadding="0" border="0"><tbody>');for(var h=0;h<o.rows.length;h++){var p=(m%2&&b.striped)?'class="datagrid-row datagrid-row-alt"':'class="datagrid-row"';var r=b.rowStyler?b.rowStyler.call(n,m,o.rows[h]):"";var c=r?'style="'+r+'"':"";var g=d.rowIdPrefix+"-"+(a?1:2)+"-"+m;q.push('<tr id="'+g+'" datagrid-row-index="'+m+'" '+p+" "+c+">");q.push(this.renderRow.call(this,n,l,a,m,o.rows[h]));q.push("</tr>");m++}q.push("</tbody></table>")}$(e).html(q.join(""))},onAfterRender:function(g){var e=$.data(g,"datagrid").options;var d=$.data(g,"datagrid").dc;var c=d.view;var b=d.view1;var a=d.view2;$.fn.datagrid.defaults.view.onAfterRender.call(this,g);if(e.rownumbers||e.frozenColumns.length){var f=b.find("div.datagrid-group")}else{var f=a.find("div.datagrid-group")}$('<td style="border:0;text-align:center;width:25px"><span class="datagrid-row-expander datagrid-row-collapse" style="display:inline-block;width:16px;height:16px;cursor:pointer">&nbsp;</span></td>').insertBefore(f.find("td"));c.find("div.datagrid-group").each(function(){var h=$(this).attr("group-index");$(this).find("span.datagrid-row-expander").bind("click",{groupIndex:h},function(i){if($(this).hasClass("datagrid-row-collapse")){$(g).datagrid("collapseGroup",i.data.groupIndex)}else{$(g).datagrid("expandGroup",i.data.groupIndex)}})})},onBeforeRender:function(g,l){var a=$.data(g,"datagrid").options;var b=[];for(var d=0;d<l.length;d++){var k=l[d];var h=e(k[a.groupField]);if(!h){h={fvalue:k[a.groupField],rows:[k],startRow:d};b.push(h)}else{h.rows.push(k)}}function e(m){for(var j=0;j<b.length;j++){var n=b[j];if(n.fvalue==m){return n}}return null}this.groups=b;var f=[];for(var d=0;d<b.length;d++){var h=b[d];for(var c=0;c<h.rows.length;c++){f.push(h.rows[c])}}$.data(g,"datagrid").data.rows=f}});$.extend($.fn.datagrid.methods,{expandGroup:function(b,a){return b.each(function(){var c=$.data(this,"datagrid").dc.view;if(a!=undefined){var d=c.find('div.datagrid-group[group-index="'+a+'"]')}else{var d=c.find("div.datagrid-group")}var e=d.find("span.datagrid-row-expander");if(e.hasClass("datagrid-row-expand")){e.removeClass("datagrid-row-expand").addClass("datagrid-row-collapse");d.next("table").show()}$(this).datagrid("fixRowHeight")})},collapseGroup:function(b,a){return b.each(function(){var c=$.data(this,"datagrid").dc.view;if(a!=undefined){var d=c.find('div.datagrid-group[group-index="'+a+'"]')}else{var d=c.find("div.datagrid-group")}var e=d.find("span.datagrid-row-expander");if(e.hasClass("datagrid-row-collapse")){e.removeClass("datagrid-row-collapse").addClass("datagrid-row-expand");d.next("table").hide()}$(this).datagrid("fixRowHeight")})}});