var scrollview2=$.extend({},$.fn.datagrid.defaults.view,{addExpandColumn:function(e,a){var d=$.data(e,"datagrid").options;if(a>=0){f(a)}else{var c=this.rows.length;for(var b=0;b<c;b++){f(this.index+b)}d.finder.getTr(e,0,"allfooter",1).each(function(){var g='<td><div style="width:25px"></div></td>';var h=$(this);if(h.is(":empty")){h.html(g)}else{if(h.children("td.datagrid-td-rownumber").length){$(g).insertAfter(h.children("td.datagrid-td-rownumber"))}else{$(g).insertBefore(h.children("td:first"))}}})}function f(i){var g=d.finder.getTr(e,i,"body",1);if(g.find("span.datagrid-row-expander").length){return}var h=[];h.push("<td>");h.push('<div style="text-align:center;width:25px;height:16px;">');h.push('<span class="datagrid-row-expander datagrid-row-expand" style="display:inline-block;width:16px;height:16px;cursor:pointer;" />');h.push("</div>");h.push("</td>");if(g.is(":empty")){g.html(h.join(""))}else{if(g.children("td.datagrid-td-rownumber").length){$(h.join("")).insertAfter(g.children("td.datagrid-td-rownumber"))}else{$(h.join("")).insertBefore(g.children("td:first"))}}$(e).datagrid("fixRowHeight",i);g.find("span.datagrid-row-expander").unbind(".datagrid").bind("click.datagrid",function(j){var k=$(this).closest("tr").attr("datagrid-row-index");if($(this).hasClass("datagrid-row-expand")){$(e).datagrid("expandRow",k)}else{$(e).datagrid("collapseRow",k)}$(e).datagrid("fixRowHeight");return false})}},render:function(k,e,a){var d=$.data(k,"datagrid");var b=d.options;var o=this.rows||[];if(!o.length){return}var h=$(k).datagrid("getColumnFields",a);if(a){if(!(b.rownumbers||(b.frozenColumns&&b.frozenColumns.length))){return}}var j=this.index;var m=['<table class="datagrid-btable" cellspacing="0" cellpadding="0" border="0"><tbody>'];for(var g=0;g<o.length;g++){var l=(j%2&&b.striped)?'class="datagrid-row datagrid-row-alt"':'class="datagrid-row"';var n=b.rowStyler?b.rowStyler.call(k,j,o[g]):"";var c=n?'style="'+n+'"':"";var f=d.rowIdPrefix+"-"+(a?1:2)+"-"+j;m.push('<tr id="'+f+'" datagrid-row-index="'+j+'" '+l+" "+c+">");m.push(this.renderRow.call(this,k,h,a,j,o[g]));m.push("</tr>");m.push('<tr style="display:none;">');if(a){m.push("<td colspan="+(h.length+2)+' style="border-right:0">')}else{m.push("<td colspan="+(h.length)+">")}m.push('<div class="datagrid-row-detail">');if(a){m.push("&nbsp;")}else{m.push(b.detailFormatter.call(k,g,o[g]))}m.push("</div>");m.push("</td>");m.push("</tr>");j++}m.push("</tbody></table>");$(e).html(m.join(""))},onBeforeRender:function(f){var d=$.data(f,"datagrid");var c=d.options;var b=d.dc;var a=this;d.onLoadSuccess=c.onLoadSuccess;c.onLoadSuccess=function(){};c.finder.getRow=function(i,h){var j=$.data(i,"datagrid").data.rows[h];if(!j){var g=$(i).datagrid("options").view;j=g.rows[h-g.index]}return j};b.body1.add(b.body2).empty();this.rows=undefined;this.r1=this.r2=[];b.body2.unbind(".datagrid").bind("scroll.datagrid",function(g){if(d.onLoadSuccess){c.onLoadSuccess=d.onLoadSuccess;d.onLoadSuccess=undefined}if(a.scrollTimer){clearTimeout(a.scrollTimer)}a.scrollTimer=setTimeout(function(){e.call(a)},50)});function e(){if(b.body2.is(":empty")){j.call(this)}else{var i=c.finder.getTr(f,this.index,"body",2);var k=c.finder.getTr(f,0,"last",2);var g=b.view2.children("div.datagrid-header").outerHeight();var m=i.position().top-g;var h=k.position().top+k.outerHeight()-g;if(m>b.body2.height()||h<0){j.call(this)}else{if(m>0){var l=Math.floor(this.index/c.pageSize);this.getRows.call(this,f,l,function(n){this.r2=this.r1;this.r1=n;this.index=(l-1)*c.pageSize;this.rows=this.r1.concat(this.r2);this.populate.call(this,f)})}else{if(h<b.body2.height()){var l=Math.floor(this.index/c.pageSize)+2;if(this.r2.length){l++}this.getRows.call(this,f,l,function(n){if(!this.r2.length){this.r2=n}else{this.r1=this.r2;this.r2=n;this.index+=c.pageSize}this.rows=this.r1.concat(this.r2);this.populate.call(this,f)})}}}}function j(){var p=$(b.body2).scrollTop();var n=Math.floor(p/25);var o=Math.floor(n/c.pageSize)+1;this.getRows.call(this,f,o,function(q){this.index=(o-1)*c.pageSize;this.rows=q;this.r1=q;this.r2=[];this.populate.call(this,f);b.body2.triggerHandler("scroll.datagrid")})}}},onAfterRender:function(d){var c=$.data(d,"datagrid").options;var a=$.data(d,"datagrid").dc;$.fn.datagrid.defaults.view.onAfterRender.call(this,d);var b=a.view1.children("div.datagrid-header").find("table");if(b.find("div.datagrid-header-expander").length){return}var e=$('<td rowspan="'+c.frozenColumns.length+'"><div class="datagrid-header-expander" style="width:25px;"></div></td>');if($("tr",b).length==0){e.wrap("<tr></tr>").parent().appendTo($("tbody",b))}else{if(c.rownumbers){e.insertAfter(b.find("td:has(div.datagrid-header-rownumber)"))}else{e.prependTo(b.find("tr:first"))}}},getRows:function(e,f,g){var b=$.data(e,"datagrid");var a=b.options;var d=(f-1)*a.pageSize;var i=b.data.rows.slice(d,d+a.pageSize);if(i.length){g.call(this,i)}else{var c=$.extend({},a.queryParams,{page:f,rows:a.pageSize});if(a.sortName){$.extend(c,{sort:a.sortName,order:a.sortOrder})}if(a.onBeforeLoad.call(e,c)==false){return}$(e).datagrid("loading");var h=a.loader.call(e,c,function(j){$(e).datagrid("loaded");var j=a.loadFilter.call(e,j);g.call(a.view,j.rows)},function(){$(e).datagrid("loaded");a.onLoadError.apply(e,arguments)});if(h==false){$(e).datagrid("loaded")}}},populate:function(e){var d=$.data(e,"datagrid");var c=d.options;var a=d.dc;var b=25;if(this.rows.length){c.view.render.call(c.view,e,a.body2,false);c.view.render.call(c.view,e,a.body1,true);a.body1.add(a.body2).children("table.datagrid-btable").css({paddingTop:this.index*b,paddingBottom:d.data.total*b-this.rows.length*b-this.index*b});c.onLoadSuccess.call(e,{total:d.data.total,rows:this.rows});this.addExpandColumn(e)}}});$.extend($.fn.datagrid.methods,{fixDetailRowHeight:function(b,a){return b.each(function(){var f=$.data(this,"datagrid").options;var e=$.data(this,"datagrid").dc;var d=f.finder.getTr(this,a,"body",1).next();var g=f.finder.getTr(this,a,"body",2).next();if(g.is(":visible")){d.css("height","");g.css("height","");var c=Math.max(d.height(),g.height());d.css("height",c);g.css("height",c)}e.body2.triggerHandler("scroll")})},getExpander:function(c,a){var b=$.data(c[0],"datagrid").options;return b.finder.getTr(c[0],a,"body",1).find("span.datagrid-row-expander")},getRowDetail:function(d,a){var b=$.data(d[0],"datagrid").options;var c=b.finder.getTr(d[0],a,"body",2);return c.next().find("div.datagrid-row-detail")},expandRow:function(b,a){return b.each(function(){var e=$(this).datagrid("options");var d=$.data(this,"datagrid").dc;var h=$(this).datagrid("getExpander",a);if(h.hasClass("datagrid-row-expand")){h.removeClass("datagrid-row-expand").addClass("datagrid-row-collapse");var c=e.finder.getTr(this,a,"body",1).next();var g=e.finder.getTr(this,a,"body",2).next();c.show();g.show();$(this).datagrid("fixDetailRowHeight",a);if(e.onExpandRow){var f=$(this).datagrid("getRows")[a];e.onExpandRow.call(this,a,f)}}})},collapseRow:function(b,a){return b.each(function(){var e=$(this).datagrid("options");var d=$.data(this,"datagrid").dc;var h=$(this).datagrid("getExpander",a);if(h.hasClass("datagrid-row-collapse")){h.removeClass("datagrid-row-collapse").addClass("datagrid-row-expand");var c=e.finder.getTr(this,a,"body",1).next();var g=e.finder.getTr(this,a,"body",2).next();c.hide();g.hide();d.body2.triggerHandler("scroll");if(e.onCollapseRow){var f=$(this).datagrid("getRows")[a];e.onCollapseRow.call(this,a,f)}}})}});