var scrollview=$.extend({},$.fn.datagrid.defaults.view,{render:function(k,e,a){var d=$.data(k,"datagrid");var b=d.options;var o=this.rows||[];if(!o.length){return}var h=$(k).datagrid("getColumnFields",a);if(a){if(!(b.rownumbers||(b.frozenColumns&&b.frozenColumns.length))){return}}var j=this.index;var m=['<table class="datagrid-btable" cellspacing="0" cellpadding="0" border="0"><tbody>'];for(var g=0;g<o.length;g++){var l=(j%2&&b.striped)?'class="datagrid-row datagrid-row-alt"':'class="datagrid-row"';var n=b.rowStyler?b.rowStyler.call(k,j,o[g]):"";var c=n?'style="'+n+'"':"";var f=d.rowIdPrefix+"-"+(a?1:2)+"-"+j;m.push('<tr id="'+f+'" datagrid-row-index="'+j+'" '+l+" "+c+">");m.push(this.renderRow.call(this,k,h,a,j,o[g]));m.push("</tr>");j++}m.push("</tbody></table>");$(e).html(m.join(""))},onBeforeRender:function(f){var d=$.data(f,"datagrid");var c=d.options;var b=d.dc;var a=this;d.onLoadSuccess=c.onLoadSuccess;c.onLoadSuccess=function(){};c.finder.getRow=function(i,h){var j=$.data(i,"datagrid").data.rows[h];if(!j){var g=$(i).datagrid("options").view;j=g.rows[h-g.index]}return j};b.body1.add(b.body2).empty();this.rows=undefined;this.r1=this.r2=[];b.body2.unbind(".datagrid").bind("scroll.datagrid",function(g){if(d.onLoadSuccess){c.onLoadSuccess=d.onLoadSuccess;d.onLoadSuccess=undefined}if(a.scrollTimer){clearTimeout(a.scrollTimer)}a.scrollTimer=setTimeout(function(){e.call(a)},50)});function e(){if(b.body2.is(":empty")){j.call(this)}else{var i=c.finder.getTr(f,this.index,"body",2);var k=c.finder.getTr(f,0,"last",2);var g=b.view2.children("div.datagrid-header").outerHeight();var m=i.position().top-g;var h=k.position().top+k.outerHeight()-g;if(m>b.body2.height()||h<0){j.call(this)}else{if(m>0){var l=Math.floor(this.index/c.pageSize);this.getRows.call(this,f,l,function(n){this.r2=this.r1;this.r1=n;this.index=(l-1)*c.pageSize;this.rows=this.r1.concat(this.r2);this.populate.call(this,f)})}else{if(h<b.body2.height()){var l=Math.floor(this.index/c.pageSize)+2;if(this.r2.length){l++}this.getRows.call(this,f,l,function(n){if(!this.r2.length){this.r2=n}else{this.r1=this.r2;this.r2=n;this.index+=c.pageSize}this.rows=this.r1.concat(this.r2);this.populate.call(this,f)})}}}}function j(){var p=$(b.body2).scrollTop();var n=Math.floor(p/25);var o=Math.floor(n/c.pageSize)+1;this.getRows.call(this,f,o,function(q){this.index=(o-1)*c.pageSize;this.rows=q;this.r1=q;this.r2=[];this.populate.call(this,f);b.body2.triggerHandler("scroll.datagrid")})}}},getRows:function(e,f,g){var b=$.data(e,"datagrid");var a=b.options;var d=(f-1)*a.pageSize;var i=b.data.rows.slice(d,d+a.pageSize);if(i.length){g.call(this,i)}else{var c=$.extend({},a.queryParams,{page:f,rows:a.pageSize});if(a.sortName){$.extend(c,{sort:a.sortName,order:a.sortOrder})}if(a.onBeforeLoad.call(e,c)==false){return}$(e).datagrid("loading");var h=a.loader.call(e,c,function(j){$(e).datagrid("loaded");var j=a.loadFilter.call(e,j);g.call(a.view,j.rows)},function(){$(e).datagrid("loaded");a.onLoadError.apply(e,arguments)});if(h==false){$(e).datagrid("loaded")}}},populate:function(e){var d=$.data(e,"datagrid");var c=d.options;var a=d.dc;var b=25;if(this.rows.length){c.view.render.call(c.view,e,a.body2,false);c.view.render.call(c.view,e,a.body1,true);a.body1.add(a.body2).children("table.datagrid-btable").css({paddingTop:this.index*b,paddingBottom:d.data.total*b-this.rows.length*b-this.index*b});c.onLoadSuccess.call(e,{total:d.data.total,rows:this.rows})}}});